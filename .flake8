# =============================================================================
# FLAKE8 Configuration - Single Source of Truth for Python Linting
# =============================================================================
#
# Used by: pre-commit hooks, CI/CD workflows, IDEs
# Referenced by: .husky/pre-commit, scripts/pre-push.sh, GitHub Actions
#
# IMPORTANT: Do NOT hardcode flake8 flags in scripts or workflows!
#            All rules are defined here and will be read automatically.
#
# Last Updated: 2026-02-04
# Constitution: v1.5.0 (XII. Configuration Management)
# =============================================================================

[flake8]
# Line length (consistent with Black, isort, ESLint, Prettier)
max-line-length = 100

# =============================================================================
# IGNORED RULES - Each with WHY, WHEN, and EXAMPLE
# =============================================================================
#
# E203 - whitespace before ':'
#   WHY: Black formatter adds space before ':' in slices (x[1 :])
#   WHEN: Always - Black compatibility required
#   EXAMPLE: data[start : end] triggers E203 but is valid Black output
#
# E231 - missing whitespace after ':'
#   WHY: f-string format specs like {price:.2f} don't need space after ':'
#   WHEN: Always - f-string formatting is common in our codebase
#   EXAMPLE: logger.debug(f"Price: {price:.2f}") triggers E231
#
# W503 - line break before binary operator
#   WHY: Black prefers line break BEFORE operators, not after
#   WHEN: Always - Black compatibility required
#   EXAMPLE: (value1\n    + value2) triggers W503 but is Black standard
#
# D1xx - Missing docstrings (D100-D107, D200, D205, D400, D401, D403)
#   WHY: POC project - full docstrings not required for every module/function
#   WHEN: Can be re-enabled for public API documentation phase
#   EXAMPLE: def helper_func(): pass (no docstring) triggers D102
#
# F401 - Module imported but unused
#   WHY: Sometimes imports are for type hints or re-exports
#   WHEN: Review during cleanup phases, can be re-enabled selectively
#   EXAMPLE: from typing import TYPE_CHECKING (used conditionally)
#
# F541 - f-string is missing placeholders
#   WHY: Sometimes f-strings are used for consistency in logging
#   WHEN: Can be re-enabled when f-string usage is standardized
#   EXAMPLE: url = f"https://api.example.com" (no placeholder needed)
#
# W293 - blank line contains whitespace
#   WHY: Editors sometimes add trailing whitespace, not a logic issue
#   WHEN: Can be re-enabled when editor configs are standardized
#   EXAMPLE: Empty line with spaces/tabs triggers W293
#
# E501 - Line too long
#   WHY: Some lines (URLs, long strings) cannot be shortened sensibly
#   WHEN: Already using max-line-length=100, this catches edge cases
#   EXAMPLE: Long URL or base64 string that exceeds 100 chars
#
# C901 - Function is too complex
#   WHY: Flake8 7.3.0 is stricter; existing code has complex functions
#   WHEN: Refactor incrementally, re-enable when complexity reduced
#   EXAMPLE: train_model() with many branches (complexity=23)
#
# F811 - Redefinition of unused name from line N
#   WHY: FastAPI allows multiple @app.get() decorators on same route
#   WHEN: Can be re-enabled after API endpoint consolidation
#   EXAMPLE: Two functions named get_stocks() with different routes
#
# E731 - do not assign a lambda expression, use a def
#   WHY: Simple lambdas in dict comprehensions are readable
#   WHEN: Can be re-enabled when lambdas are converted to defs
#   EXAMPLE: sort_key = lambda x: x.score (simple one-liner)
#
extend-ignore = E203, E231, W503, D100, D101, D102, D103, D104, D105, D107, D200, D205, D400, D401, D403, F401, F541, W293, E501, C901, F811, E731

# =============================================================================
# EXCLUDED DIRECTORIES
# =============================================================================
exclude =
    .git,
    __pycache__,
    .venv,
    .venv-1,
    venv,
    build,
    dist,
    *.egg-info,
    .eggs,
    .mypy_cache,
    .pytest_cache,
    mlruns,
    models,
    node_modules,
    frontend,
    archive,

# =============================================================================
# COMPLEXITY SETTINGS
# =============================================================================
# Max cyclomatic complexity (McCabe)
# Default is 10, increased to 25 for compatibility with existing code
# TODO: Gradually reduce to 15 as code is refactored
max-complexity = 25

# =============================================================================
# OUTPUT SETTINGS
# =============================================================================
# Show source code for errors (helpful for debugging)
show-source = true

# Show statistics at end of run
statistics = true

# Count total errors
count = true
