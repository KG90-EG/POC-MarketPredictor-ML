
groups:
  - name: ml_model_alerts
    interval: 30s
    rules:
      # Model performance alerts
      - alert: LowModelAccuracy
        expr: ml_model_accuracy < 0.65
        for: 5m
        labels:
          severity: warning
          component: ml-model
        annotations:
          summary: "Model accuracy below threshold"
          description: "Model {{$labels.model_name}} accuracy is {{$value}}, below 0.65 threshold"

      - alert: LowF1Score
        expr: ml_model_f1_score < 0.70
        for: 5m
        labels:
          severity: warning
          component: ml-model
        annotations:
          summary: "Model F1 score below threshold"
          description: "Model {{$labels.model_name}} F1 score is {{$value}}, below 0.70 threshold"

      # Drift detection alerts
      - alert: ConceptDriftDetected
        expr: rate(ml_drift_detected_total{severity="drift"}[5m]) > 0
        for: 1m
        labels:
          severity: critical
          component: drift-detection
        annotations:
          summary: "Concept drift detected"
          description: "Drift detector {{$labels.detector_type}} detected concept drift"

      - alert: HighDriftWarningRate
        expr: rate(ml_drift_detected_total{severity="warning"}[10m]) > 5
        for: 5m
        labels:
          severity: warning
          component: drift-detection
        annotations:
          summary: "High drift warning rate"
          description: "Frequent drift warnings from {{$labels.detector_type}}"

      # Training alerts
      - alert: TrainingFailures
        expr: rate(ml_training_runs_total{status="failure"}[1h]) > 0.1
        for: 5m
        labels:
          severity: warning
          component: training
        annotations:
          summary: "High training failure rate"
          description: "Model {{$labels.model_type}} has failing training runs"

      - alert: NoRecentTraining
        expr: time() - ml_last_training_timestamp > 86400
        for: 1h
        labels:
          severity: warning
          component: training
        annotations:
          summary: "No recent model training"
          description: "Model {{$labels.model_type}} hasn't trained in 24+ hours"

      # API performance alerts
      - alert: HighAPILatency
        expr: histogram_quantile(0.95, rate(api_request_duration_seconds_bucket[5m])) > 1.0
        for: 5m
        labels:
          severity: warning
          component: api
        annotations:
          summary: "High API latency"
          description: "95th percentile latency for {{$labels.endpoint}} is {{$value}}s"

      - alert: HighErrorRate
        expr: rate(api_errors_total[5m]) > 0.05
        for: 2m
        labels:
          severity: critical
          component: api
        annotations:
          summary: "High API error rate"
          description: "Error rate on {{$labels.endpoint}} is {{$value}}/sec"

      # System health alerts
      - alert: ComponentUnhealthy
        expr: system_health_status == 0
        for: 2m
        labels:
          severity: critical
          component: system
        annotations:
          summary: "System component unhealthy"
          description: "Component {{$labels.component}} is reporting unhealthy status"

      - alert: LowCacheHitRatio
        expr: cache_hit_ratio < 0.5
        for: 10m
        labels:
          severity: warning
          component: cache
        annotations:
          summary: "Low cache hit ratio"
          description: "Cache hit ratio is {{$value}}, below 0.5 threshold"

      # Prediction alerts
      - alert: HighPredictionLatency
        expr: histogram_quantile(0.95, rate(ml_prediction_latency_seconds_bucket[5m])) > 0.1
        for: 5m
        labels:
          severity: warning
          component: prediction
        annotations:
          summary: "High prediction latency"
          description: "95th percentile prediction latency is {{$value}}s"

      - alert: NoRecentPredictions
        expr: rate(ml_predictions_total[5m]) == 0
        for: 10m
        labels:
          severity: warning
          component: prediction
        annotations:
          summary: "No recent predictions"
          description: "Model {{$labels.model_name}} hasn't made predictions in 10+ minutes"
