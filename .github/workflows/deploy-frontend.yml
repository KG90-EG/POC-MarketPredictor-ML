name: Deploy Frontend (Netlify)

# Optional GitHub Secrets for Netlify deployment (see GITHUB_SECRETS.md):
#   - NETLIFY_AUTH_TOKEN: Netlify API authentication (optional)
#   - NETLIFY_SITE_ID: Netlify site identifier (optional)
# Note: Only needed if using Netlify instead of Vercel. Default deployment uses Vercel.
# Setup guide: https://github.com/KG90-EG/POC-MarketPredictor-ML/blob/main/GITHUB_SECRETS.md

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install deps & build
        working-directory: frontend
        run: |
          npm ci
          npm run build
      - name: Deploy to Netlify
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        run: |
          if [ -z "$NETLIFY_AUTH_TOKEN" ] || [ -z "$NETLIFY_SITE_ID" ]; then
            echo "::notice::Netlify secrets not configured. Skipping deployment. See SECRETS.md for setup."
            exit 0
          fi
          npm install -g netlify-cli
          netlify deploy --prod --dir=frontend/dist --auth "$NETLIFY_AUTH_TOKEN" --site "$NETLIFY_SITE_ID"
      - name: Post deploy summary
        run: echo "Deployment attempted; check Netlify dashboard for status."
